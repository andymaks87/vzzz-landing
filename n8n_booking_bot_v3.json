{
    "name": "Vazuza Booking Bot v3 (Fixed Routing)",
    "nodes": [
        {
            "parameters": {
                "updates": [
                    "message"
                ],
                "additionalFields": {}
            },
            "name": "Telegram Trigger",
            "type": "n8n-nodes-base.telegramTrigger",
            "typeVersion": 1,
            "position": [
                250,
                300
            ],
            "credentials": {
                "telegramApi": {
                    "id": "YOUR_CREDENTIAL_ID",
                    "name": "Telegram account"
                }
            }
        },
        {
            "parameters": {
                "dataType": "string",
                "value1": "={{$json[\"message\"][\"text\"]}}",
                "rules": {
                    "rules": [
                        {
                            "value2": "/start",
                            "operation": "contains"
                        },
                        {
                            "value2": "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å",
                            "operation": "contains"
                        },
                        {
                            "value2": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ–∫",
                            "operation": "contains"
                        }
                    ]
                },
                "fallbackSettings": {}
            },
            "name": "Router",
            "type": "n8n-nodes-base.switch",
            "typeVersion": 1,
            "position": [
                500,
                300
            ]
        },
        {
            "parameters": {
                "chatId": "={{$node[\"Telegram Trigger\"].json[\"message\"][\"chat\"][\"id\"]}}",
                "text": "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ FisherHouse!\n\n–Ø –ø–æ–º–æ–≥—É –≤–∞–º –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º –∏–ª–∏ –ø—Ä–∏–Ω—è—Ç—å –æ–ø–ª–∞—Ç—É.\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∏–∂–µ:",
                "replyMarkup": "replyKeyboard",
                "replyKeyboardOptions": {
                    "resize_keyboard": true,
                    "one_time_keyboard": false,
                    "keyboard": [
                        [
                            {
                                "text": "üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º"
                            },
                            {
                                "text": "üßæ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ–∫"
                            }
                        ],
                        [
                            {
                                "text": "üìç –ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è"
                            },
                            {
                                "text": "üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º"
                            }
                        ]
                    ]
                }
            },
            "name": "Send Welcome",
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1,
            "position": [
                800,
                100
            ],
            "credentials": {
                "telegramApi": {
                    "id": "YOUR_CREDENTIAL_ID",
                    "name": "Telegram account"
                }
            }
        },
        {
            "parameters": {
                "chatId": "={{$node[\"Telegram Trigger\"].json[\"message\"][\"chat\"][\"id\"]}}",
                "text": "–î–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –Ω–∞—à —Å–∞–π—Ç –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—ã–µ –¥–∞—Ç—ã:",
                "replyMarkup": "inlineKeyboard",
                "inlineKeyboardOptions": {
                    "rows": [
                        [
                            {
                                "text": "üìÖ –û—Ç–∫—Ä—ã—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å",
                                "url": "https://vazuza-fisherhouse.ru/#booking"
                            }
                        ]
                    ]
                }
            },
            "name": "Send Booking Link",
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1,
            "position": [
                800,
                300
            ],
            "credentials": {
                "telegramApi": {
                    "id": "YOUR_CREDENTIAL_ID",
                    "name": "Telegram account"
                }
            }
        },
        {
            "parameters": {
                "chatId": "={{$node[\"Telegram Trigger\"].json[\"message\"][\"chat\"][\"id\"]}}",
                "text": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —á–µ–∫–∞ –∏–ª–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç –æ–ø–ª–∞—Ç—ã –ø—Ä—è–º–æ –≤ —ç—Ç–æ—Ç —á–∞—Ç. –Ø –ø–µ—Ä–µ–¥–∞–º –µ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."
            },
            "name": "Ask for Receipt",
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1,
            "position": [
                800,
                500
            ],
            "credentials": {
                "telegramApi": {
                    "id": "YOUR_CREDENTIAL_ID",
                    "name": "Telegram account"
                }
            }
        },
        {
            "parameters": {
                "conditions": {
                    "boolean": [
                        {
                            "value1": "={{$node[\"Telegram Trigger\"].json[\"message\"][\"photo\"] ? true : false}}",
                            "value2": true
                        }
                    ]
                }
            },
            "name": "Check for Photo",
            "type": "n8n-nodes-base.if",
            "typeVersion": 1,
            "position": [
                500,
                600
            ]
        },
        {
            "parameters": {
                "authentication": "serviceAccount",
                "documentId": {
                    "__rl": true,
                    "value": "={{$env[\"GOOGLE_SHEETS_SHEET_ID\"]}}",
                    "mode": "id"
                },
                "sheetName": {
                    "__rl": true,
                    "value": "Sheet1",
                    "mode": "name"
                },
                "options": {}
            },
            "name": "Log to Sheets",
            "type": "n8n-nodes-base.googleSheets",
            "typeVersion": 3,
            "position": [
                650,
                700
            ],
            "credentials": {
                "googleApi": {
                    "id": "YOUR_GOOGLE_CREDENTIAL_ID",
                    "name": "Google Sheets Account"
                }
            }
        },
        {
            "parameters": {
                "chatId": "={{$env[\"ADMIN_GROUP_CHAT_ID\"]}}",
                "text": "üí∞ *–ù–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞!*\n\n–ò–º—è: {{$node[\"Telegram Trigger\"].json[\"message\"][\"from\"][\"first_name\"]}} {{$node[\"Telegram Trigger\"].json[\"message\"][\"from\"][\"last_name\"]}}\nUsername: @{{$node[\"Telegram Trigger\"].json[\"message\"][\"from\"][\"username\"]}}",
                "additionalFields": {
                    "parse_mode": "Markdown",
                    "appendAttribution": false
                }
            },
            "name": "Forward to Group",
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1,
            "position": [
                800,
                700
            ],
            "credentials": {
                "telegramApi": {
                    "id": "YOUR_CREDENTIAL_ID",
                    "name": "Telegram account"
                }
            }
        },
        {
            "parameters": {
                "chatId": "={{$env[\"ADMIN_GROUP_CHAT_ID\"]}}",
                "file": "={{$node[\"Telegram Trigger\"].json[\"message\"][\"photo\"].pop()[\"file_id\"]}}",
                "additionalFields": {
                    "caption": "–°–∫—Ä–∏–Ω—à–æ—Ç –æ–ø–ª–∞—Ç—ã"
                }
            },
            "name": "Forward Photo",
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1,
            "position": [
                1000,
                700
            ],
            "credentials": {
                "telegramApi": {
                    "id": "YOUR_CREDENTIAL_ID",
                    "name": "Telegram account"
                }
            }
        },
        {
            "parameters": {
                "chatId": "={{$node[\"Telegram Trigger\"].json[\"message\"][\"chat\"][\"id\"]}}",
                "text": "‚úÖ –°–ø–∞—Å–∏–±–æ! –ß–µ–∫ –ø–æ–ª—É—á–µ–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—Ä–æ–Ω–∏."
            },
            "name": "Confirm Receipt Client",
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1,
            "position": [
                1200,
                700
            ],
            "credentials": {
                "telegramApi": {
                    "id": "YOUR_CREDENTIAL_ID",
                    "name": "Telegram account"
                }
            }
        }
    ],
    "connections": {
        "Telegram Trigger": {
            "main": [
                [
                    {
                        "node": "Router",
                        "type": "main",
                        "index": 0
                    },
                    {
                        "node": "Check for Photo",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Router": {
            "main": [
                [
                    {
                        "node": "Send Welcome",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Send Booking Link",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Ask for Receipt",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Check for Photo": {
            "main": [
                [
                    {
                        "node": "Log to Sheets",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Log to Sheets": {
            "main": [
                [
                    {
                        "node": "Forward to Group",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Forward to Group": {
            "main": [
                [
                    {
                        "node": "Forward Photo",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Forward Photo": {
            "main": [
                [
                    {
                        "node": "Confirm Receipt Client",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    }
}